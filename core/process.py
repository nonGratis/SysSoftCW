
"""
Модуль представлення процесів користувача в операційній системі.

Визначає структуру та поведінку процесів користувача, що виконують
послідовність операцій читання та запису до жорсткого диска в рамках
симуляції багатозадачної операційної системи з квантуванням часу.

Автор: Студент
Курсова робота: Алгоритми планування введення-виведення для жорсткого диска
"""

from typing import List, Optional, Tuple
from core.events import RequestType


class Process:
    """
    Представлення процесу користувача в операційній системі.
    
    Процес моделює виконання програми користувача, що здійснює послідовні
    звернення до секторів жорсткого диска для читання або запису даних.
    Кожен процес має власний стан виконання, квант часу процесора та
    послідовність операцій введення-виведення для виконання.
    
    Атрибути:
        pid: Унікальний ідентифікатор процесу в системі, що використовується
            для відстеження стану процесу та його запитів введення-виведення
        sector_sequence: Послідовність операцій процесу у вигляді списку
                        кортежів, де кожен елемент містить тип операції
                        та номер сектора для обробки
        current_index: Поточна позиція у послідовності операцій, що вказує
                      на наступну операцію для виконання процесом
        state: Поточний стан процесу в системі, що може приймати значення
              READY (готовий до виконання), RUNNING (виконується),
              BLOCKED (заблокований на введенні-виведенні) або
              FINISHED (завершив всі операції)
        quantum_remaining: Залишок кванта часу процесора для виконання процесу
                          у мілісекундах до переміщення в кінець черги процесів
    """
    
    def __init__(self, pid: int, sector_sequence: List[Tuple[RequestType, int]]):
        """
        Ініціалізує процес із заданою послідовністю операцій введення-виведення.
        
        Створює новий процес у стані готовності до виконання з повною
        послідовністю операцій читання та запису секторів диска. Процес
        починає виконання з першої операції у послідовності та переходить
        до наступних операцій у міру їх завершення.
        
        Args:
            pid: Унікальний ідентифікатор процесу для використання в системі
            sector_sequence: Список кортежів, де кожен кортеж містить тип
                           операції та номер сектора у форматі tuple із
                           елементами RequestType та int відповідно
        """
        self.pid = pid
        self.sector_sequence = sector_sequence
        self.current_index = 0
        self.state = "READY"
        self.quantum_remaining = 0
    
    def get_next_request(self) -> Optional[Tuple[RequestType, int]]:
        """
        Повертає наступний запит для виконання без зміни внутрішнього стану.
        
        Метод надає доступ до наступної операції у послідовності процесу
        без переміщення покажчика поточної позиції. Це дозволяє симулятору
        переглянути операцію перед її фактичним виконанням для планування
        та підготовки необхідних ресурсів системи.
        
        Returns:
            Кортеж з типом операції та номером сектора для наступного запиту
            або значення None якщо всі операції в послідовності вже виконано
            і процес готовий до завершення роботи в системі
        """
        if self.current_index < len(self.sector_sequence):
            return self.sector_sequence[self.current_index]
        return None
    
    def advance(self):
        """
        Переміщує внутрішній покажчик на наступну операцію в послідовності.
        
        Метод викликається після успішного завершення поточної операції
        введення-виведення для переходу до обробки наступного запиту в
        послідовності процесу. Інкрементування індексу забезпечує лінійне
        проходження через всі заплановані операції до завершення процесу.
        """
        self.current_index += 1
    
    def is_finished(self) -> bool:
        """
        Перевіряє чи завершено виконання всіх операцій процесу в системі.
        
        Метод визначає чи процес виконав всі заплановані операції читання
        та запису секторів диска і готовий до завершення та видалення зі
        списку активних процесів операційної системи. Перевірка виконується
        шляхом порівняння поточного індексу з загальною кількістю операцій.
        
        Returns:
            Булеве значення True якщо всі операції в послідовності виконано
            та процес може бути переведений у стан завершення, або False
            якщо процес має невиконані операції та повинен продовжити роботу
        """
        return self.current_index >= len(self.sector_sequence)